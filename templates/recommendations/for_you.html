{% extends "base.html" %}
{% block head %}
<title>For You — AudioBook Request</title>
<script>
    const onPageChange = page => {
        const url = new URL(window.location);
        url.searchParams.set("page", page);
        window.location = url;
    };
</script>
{% endblock head %}
{% block body %}
<div class="app-shell p-6 sm:p-8">
    <div class="app-content app-stack app-stagger">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold">For You</h1>
            <p class="opacity-70">Personalized picks based on your requests{% if has_next %}, showing {{
                recommendations|length }}
                of {{ total_items }}{% endif %}</p>
        </div>
        <a href="{{ base_url }}/search" class="btn btn-primary flex items-center gap-2" title="Search for books">
            <span>Search</span>
            {% include "icons/search.html" %}
        </a>
    </div>

    <div class="w-full">
        {% if recommendations %}
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 app-stagger">
            {% for rec in recommendations %}
            {% set book = rec.book %}
            <div>
                {% include "components/book_card.html" %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-16">
            <h3 class="text-2xl font-semibold mt-2">No personalized recommendations yet</h3>
            <p class="opacity-70 mt-1">Request a few audiobooks to help us learn your tastes.</p>
            <a href="{{ base_url }}/search" class="btn btn-primary mt-4">Search for Books</a>
        </div>
        {% endif %}
    </div>

    {% if recommendations or page > 0 %}
    <div class="join">
        <button class="join-item btn" onclick="onPageChange('{{ page-1 }}')" {% if page.__eq__(1) %}disabled{% endif
            %}>«</button>
        <button class="join-item btn flex flex-col gap-0" onclick="onPageChange('{{ 1 }}')" {% if page.__eq__(1)
            %}disabled{% endif %}>
            Page {{ page }}
            <span class="text-[0.5rem]">back to first</span>
        </button>
        <button class="join-item btn" {% if not has_next %}disabled{% endif %}
            onclick="onPageChange('{{ page+1 }}')">»</button>
    </div>
    {% endif %}
    </div>
</div>
{% endblock body %}
