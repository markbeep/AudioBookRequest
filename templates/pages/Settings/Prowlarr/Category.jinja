{#def
    indexer_categories: dict[int, str],
    selected_categories: set[int],
#}

<form id="category-select"
      class="flex flex-col gap-2"
      x-data="{ selected: [{{ selected_categories|join(",") }}].sort(), categories: {{ indexer_categories }} }"
      hx-put="{{ base_url }}/settings/prowlarr/hx-category"
      hx-disabled-elt="#category-submit-button"
      hx-target="this"
      hx-swap="outerHTML">
    <label for="categories">
        Categories
    </label>
    <p class="text-xs opacity-60">
        Categories to search for using Prowlarr. If none are selected, all
        categories will be searched for.
    </p>

    <div class="flex flex-wrap gap-1">
        <template x-for="sel in selected">
            <div class="badge badge-secondary badge-sm w-52 justify-between h-fit">
                <input type="hidden" name="c" x-bind:value="sel" />
                <span x-text="`${String(sel).padStart(4, '0')} - ${categories[sel]}`"></span>
                <button class="cursor-pointer [&>svg]:size-4 hover:opacity-70 transition-opacity duration-150"
                        x-on:click="selected = selected.filter((item) => item !== sel)"
                        type="button">
                    <icons.XMark />
                </button>
            </div>
        </template>
    </div>
    <select id="categories"
            name="group"
            class="select w-full"
            x-on:change="selected = [...selected, $event.target.value].sort()"
            x-init="$el.value = ''">
        <option disabled selected value>
            -- select a category --
        </option>
        <template x-for="sel in Object.keys(categories)">
            <template x-if="!selected.includes(Number(sel))">
                <option x-text="`${String(sel).padStart(4, '0')} - ${categories[sel]}`"
                        x-bind:value="sel">
                </option>
            </template>
        </template>
    </select>

    <div class="join w-full">
        <input type="number"
               class="input input-bordered join-item w-full"
               placeholder="3130"
               x-ref="customCategoryInput" />
        <button class="btn btn-primary join-item"
                type="button"
                x-on:click=" const val = Number($refs.customCategoryInput.value); if (val && !selected.includes(val)) { selected = [...selected, val].sort(); $refs.customCategoryInput.value = ''; } ">
            Add custom
        </button>
    </div>

    <button id="category-submit-button"
            x-data="{ initial: selected }"
            x-bind:disabled="JSON.stringify(initial) === JSON.stringify(selected)"
            class="btn">
        Save categories
    </button>
</form>
