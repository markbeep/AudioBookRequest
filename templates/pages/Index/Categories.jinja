{#def
    region_tld: str,
    auto_start_download: bool,
    user: DetailedUser,
    categories: dict[str, list[Audiobook]] = {},
    lazy_load = False,
#}

{% if lazy_load %}
    <div hx-get="{{ base_url }}/hx-categories"
         hx-trigger="load"
         hx-swap="outerHTML">
    </div>

{% else %}
    <div class="w-screen flex flex-col items-center justify-center p-6 sm:p-8 overflow-x-hidden gap-6">

        <!-- Trending Section -->
        {% block categories %}
            {% if categories %}
                {% if categories.trending %}
                    <div class="w-full max-w-7xl mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold">
                                Trending This Week
                            </h2>
                            <a href="{{ base_url }}/search?q=trending" class="link link-primary">
                                View all →
                            </a>
                        </div>
                        <div class="overflow-x-auto">
                            <div class="flex gap-4 pb-4" style="width: max-content">
                                {% for book in categories.trending[:12] %}
                                    <div class="flex-none w-32 sm:w-40">
                                        <BookCard book_with_requests={{ book }} auto_start_download={{ auto_start_download }} region_tld="{{ region_tld }}" user={{ user }} />
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Business & Self-Help -->
                {% if categories.business %}
                    <div class="w-full max-w-7xl mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold">
                                Business & Self-Help
                            </h2>
                            <a href="{{ base_url }}/search?q=business" class="link link-primary">
                                View all →
                            </a>
                        </div>
                        <div class="overflow-x-auto">
                            <div class="flex gap-4 pb-4" style="width: max-content">
                                {% for book in categories.business[:12] %}
                                    <div class="flex-none w-32 sm:w-40">
                                        <BookCard book_with_requests={{ book }} auto_start_download={{ auto_start_download }} region_tld="{{ region_tld }}" user={{ user }} />
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Fiction & Literature -->
                {% if categories.fiction %}
                    <div class="w-full max-w-7xl mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold">
                                Fiction & Literature
                            </h2>
                            <a href="{{ base_url }}/search?q=fiction" class="link link-primary">
                                View all →
                            </a>
                        </div>
                        <div class="overflow-x-auto">
                            <div class="flex gap-4 pb-4" style="width: max-content">
                                {% for book in categories.fiction[:12] %}
                                    <div class="flex-none w-32 sm:w-40">
                                        <BookCard book_with_requests={{ book }} auto_start_download={{ auto_start_download }} region_tld="{{ region_tld }}" user={{ user }} />
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Biography & History -->
                {% if categories.biography %}
                    <div class="w-full max-w-7xl mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold">
                                Biography & History
                            </h2>
                            <a href="{{ base_url }}/search?q=biography" class="link link-primary">
                                View all →
                            </a>
                        </div>
                        <div class="overflow-x-auto">
                            <div class="flex gap-4 pb-4" style="width: max-content">
                                {% for book in categories.biography[:12] %}
                                    <div class="flex-none w-32 sm:w-40">
                                        <BookCard book_with_requests={{ book }} auto_start_download={{ auto_start_download }} region_tld="{{ region_tld }}" user={{ user }} />
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Science & Technology -->
                {% if categories.science %}
                    <div class="w-full max-w-7xl mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold">
                                Science & Technology
                            </h2>
                            <a href="{{ base_url }}/search?q=science" class="link link-primary">
                                View all →
                            </a>
                        </div>
                        <div class="overflow-x-auto">
                            <div class="flex gap-4 pb-4" style="width: max-content">
                                {% for book in categories.science[:12] %}
                                    <div class="flex-none w-32 sm:w-40">
                                        <BookCard book_with_requests={{ book }} auto_start_download={{ auto_start_download }} region_tld="{{ region_tld }}" user={{ user }} />
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- New Releases -->
                {% if categories.recent_releases %}
                    <div class="w-full max-w-7xl mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-2xl font-bold">
                                New Releases
                            </h2>
                            <a href="{{ base_url }}/search?q=new+release" class="link link-primary">
                                View all →
                            </a>
                        </div>
                        <div class="overflow-x-auto">
                            <div class="flex gap-4 pb-4" style="width: max-content">
                                {% for book in categories.recent_releases[:12] %}
                                    <div class="flex-none w-32 sm:w-40">
                                        <BookCard book_with_requests={{ book }} auto_start_download={{ auto_start_download }} region_tld="{{ region_tld }}" user={{ user }} />
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endif %}

            {% else %}
                <div class="w-full max-w-7xl mb-8 flex flex-col items-center justify-center">
                    <h3 class="text-xl font-semibold mb-4">
                        Loading Categories...
                    </h3>
                    <span class="loading loading-dots loading-xl" />
                </div>
            {% endif %}
        {% endblock categories %}
    </div>

{% endif %}
