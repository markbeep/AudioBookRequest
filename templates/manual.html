{% extends "base.html" %}
{% block head %}
  <title>Manual Entry</title>
{% endblock head %}
{% block body %}
  <div class="app-shell p-6 sm:p-8">
    <div class="app-content max-w-2xl">
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-left mb-2">Manual Request</h1>
        <p class="text-sm opacity-70">Add audiobooks that aren't available through Audible search</p>
      </div>
      {% block form %}
        <form class="flex flex-col gap-4 w-full app-card app-panel"
              {% if book %}
              hx-post="{{ base_url }}/search/manual?id={{ book.id }}"
              {% else %}
              hx-post="{{ base_url }}/search/manual"
              {% endif %}
              hx-target="this"
              hx-swap="outerHTML"
              hx-disabled-elt="#submit-button">
          {% if auto_download %}
          <div class="alert alert-info py-2 rounded-lg">
            <span>{% include "icons/info-circle.html" %}</span>
            <span class="text-sm">Manual requests do not automatically start a download. They have to be manually reviewed.</span>
          </div>
          {% endif %}
          {% if success %}<script>toast("{{success|safe}}", "success");</script>{% endif %}
          
          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Title <span class="text-error">*</span></span>
            </label>
            <input id="title"
                   name="title"
                   type="text"
                   class="input input-bordered focus:input-primary"
                   minlength="1"
                   required
                   value="{{ book.title if book else '' }}"
                   placeholder="The Fellowship of the Ring" />
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Subtitle</span>
            </label>
            <input id="subtitle"
                   name="subtitle"
                   class="input input-bordered focus:input-primary"
                   type="text"
                   value="{{ book.subtitle if book else '' }}"
                   placeholder="The Lord of the Rings" />
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Author(s) <span class="text-error">*</span></span>
            </label>
            <input id="author"
                   name="author"
                   type="text"
                   class="input input-bordered focus:input-primary"
                   minlength="1"
                   value="{{ book.authors|join(', ') if book else '' }}"
                   required
                   placeholder="J.R.R. Tolkien" />
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Narrator(s)</span>
            </label>
            <input id="narrator"
                   name="narrator"
                   type="text"
                   value="{{ book.narrators|join(', ') if book else '' }}"
                   class="input input-bordered focus:input-primary"
                   placeholder="Andy Serkis" />
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Publish Date</span>
            </label>
            <input id="publish_date"
                   name="publish_date"
                   type="text"
                   value="{{ book.publish_date if book else '' }}"
                   class="input input-bordered focus:input-primary"
                   placeholder="2021-09" />
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text font-semibold">Additional Info</span>
            </label>
            <textarea id="info"
                      name="info"
                      class="textarea textarea-bordered focus:textarea-primary"
                      value="{{ book.additional_info if book else '' }}"
                      placeholder="The book about the ring"></textarea>
          </div>

          <div class="flex gap-3 pt-4">
            <button id="submit-button" class="btn btn-primary btn-sm" type="submit">
              {% if book %}Update{% else %}Add{% endif %} Request
            </button>
            <a href="{{ base_url }}/search" class="btn btn-ghost btn-sm">Cancel</a>
          </div>
        </form>
      {% endblock form %}
    </div>
  </div>
{% endblock body %}
