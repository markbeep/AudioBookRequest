# Contributing to AudioBookRequest

Happy to hear you're interested in contributing! Contributions are always welcome.
Please read through the following points to ensure both a more straightforward implementation on your side as well as allowing for an easier review process by the maintainers.

Please also regard [the use of AI](#the-use-of-ai).

## Getting Started

1. Fork the repository on Github.
2. Clone your fork locally:
   ```sh
   git clone git@github.com:<username>/AudioBookRequest.git # SSH
   git clone https://github.com/<username>/AudioBookRequest.git # HTTP
   cd AudioBookRequest
   ```
3. Use the VSCode/Zed devcontainer if possible. It has all development tools pre-installed.
4. Run the database migrations and start up the website locally:
   ```sh
   uv run alembic upgrade heads
   uv run fastapi dev
   ```

## How to Contribute

### Reporting a Bug

If you find a bug, please create a new issue. Include:

1. A snippet of your logs. If possible, set the `ABR_APP__LOG_LEVEL=DEBUG` environment variable to show even more logs.
2. Expected behavior vs the actual behavior.
3. How ABR is deployed (docker-compose, Kubernetes, Unrain, etc.)
4. The ABR version. If on `nightly`, go to a settings page and get the exact version on the bottom right.

### Suggesting Features

For any new features, please first open an issue or use an already existing issue to first discuss the idea. Especially, if the change is substantial, first discusss it in an issue before opening a multi-thousand line pull request.

### Pull Requests

1. Create a new branch on your fork (avoid submitting PRs from main so you can keep it synced).
2. Run typing and formatting checks locally:
   ```sh
   uv run basedpyright # strict static typing
   uv run ruff format --check app # formatting
   ```
3. Ensure there are no missing migrations:
   ```sh
   uv run alembic check
   ```
4. If you have added any new migrations, ensure that the new migrations **correctly** upgrade and downgrade for both SQLite and Postgres (filled with some data). The local `docker-compose.yml` can be used to spin up a postgres instance.

## The use of AI

AI can be helpful in writing code, especially in a new/unknown codebase. But it can quickly churn out thousands of lines of changes with no logical thought behind them.

It can make sense to distinguish between two types of AI-coding:

- **Implementation-driven:** You already have a strong plan in mind on how to implement a feature. But you use AI to write the code faster. You then validate the changes to ensure the AI implemented everything like you had in mind. This is an acceptable use of AI.
- **Feature-driven / Vibecoding:** This is when you want to add a feature, but are unsure how exactly, so you prompt the AI and it adds a few hundreds (or thousands) lines of code. This pushes a large part of work on the reviewing process and causes a lot of unnecessary work by the maintainers. **Pull requests with large amounts of uncessecary and cleary AI-generated code may be rejected.**

There are two types of files that should NOT be generated by AI:

- **Authentication:** Only change around authentication if you know what you're doing! Writing authentication manually helps with you being fully aware of the flow and determining if it makes sense and is secure.
- **Database migrations:** Alembic auto-generates migrations. Adjust the files manually to ensure both the upgrade and downgrade path both logically make sense and practically are executed correctly.

## Code Style

- Please orient yourself to the surrounding code style.
- Ensure your code is correctly formatted before submitting.

## Community

Join the Discord (linked in README) to discuss development and get help.
